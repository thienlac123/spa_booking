@model IEnumerable<DoAnSPA.Models.LichHen>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "Lịch hẹn";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";

    var thongKe = ViewBag.ThongKeTrangThai as Dictionary<string, int> ?? new Dictionary<string, int>();
    int ChoXacNhanCount = thongKe.ContainsKey("ChoXacNhan") ? thongKe["ChoXacNhan"] : 0;
    int DaXacNhanCount = thongKe.ContainsKey("DaXacNhan") ? thongKe["DaXacNhan"] : 0;
    int HoanThanhCount = thongKe.ContainsKey("HoanThanh") ? thongKe["HoanThanh"] : 0;
    int DaHuyCount = thongKe.ContainsKey("DaHuy") ? thongKe["DaHuy"] : 0;
}

<form method="get" asp-action="LichHen" asp-controller="Admin" class="mb-3 d-flex align-items-center gap-2 flex-wrap">
    <label for="ngayBatDau" class="fw-semibold mb-0">Từ ngày:</label>
    <input type="date" id="ngayBatDau" name="ngayBatDau" class="form-control" style="max-width: 180px;" value="@ViewBag.NgayBatDau" />

    <label for="ngayKetThuc" class="fw-semibold mb-0">Đến ngày:</label>
    <input type="date" id="ngayKetThuc" name="ngayKetThuc" class="form-control" style="max-width: 180px;" value="@ViewBag.NgayKetThuc" />

    <button type="submit" class="btn btn-primary">Lọc</button>
</form>

<style>
    .card .card-title {
        font-weight: 700;
        font-size: 2.5rem;
        color: #000 !important;
        text-shadow: none;
    }

    .card-header {
        color: #000 !important;
        font-weight: 600;
        text-shadow: none;
        background-color: rgba(255,255,255,0.7) !important;
    }

    .bg-secondary {
        background-color: #e0e0e0 !important;
    }

    .bg-primary {
        background-color: #bbdefb !important;
    }

    .bg-success {
        background-color: #c8e6c9 !important;
    }

    .bg-danger {
        background-color: #ffcdd2 !important;
    }

    .table-dark {
        background-color: #f8f9fa !important;
        border-bottom: 2px solid #000 !important;
    }

        .table-dark th {
            color: #000 !important;
            font-weight: 700 !important;
            font-size: 1.1rem !important;
            padding: 12px 10px !important;
            text-transform: none !important;
            letter-spacing: normal !important;
            border: none !important;
        }

    .table thead {
        background: linear-gradient(to bottom, #f1f1f1, #e1e1e1) !important;
    }
</style>

<h2>@ViewData["Title"]</h2>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-secondary mb-3" style="max-width: 18rem;">
            <div class="card-header">Chờ xác nhận</div>
            <div class="card-body">
                <h5 class="card-title">@ChoXacNhanCount</h5>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-primary mb-3" style="max-width: 18rem;">
            <div class="card-header">Đã xác nhận</div>
            <div class="card-body">
                <h5 class="card-title">@DaXacNhanCount</h5>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success mb-3" style="max-width: 18rem;">
            <div class="card-header">Hoàn thành</div>
            <div class="card-body">
                <h5 class="card-title">@HoanThanhCount</h5>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-danger mb-3" style="max-width: 18rem;">
            <div class="card-header">Đã hủy</div>
            <div class="card-body">
                <h5 class="card-title">@DaHuyCount</h5>
            </div>
        </div>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<table class="table table-bordered table-hover">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Dịch vụ</th>
            <th>Tên người đặt</th>
            <th>Số điện thoại</th>
            <th>Ngày</th>
            <th>Giờ</th>
            <th>Ghi chú</th>
            <th>Trạng thái</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.lichHenId</td>
                <td>@item.DichVu?.TenDichVu</td>
                <td>@item.TenNguoiDat</td>
                <td>@item.SoDienThoai</td>
                <td>@item.ngayHen.ToString("dd/MM/yyyy")</td>
                <td>@item.gioHen.ToString(@"hh\:mm")</td>
                <td>@item.ghiChu</td>
                <td>
                    @switch (item.trangThai)
                    {
                        case "ChoXacNhan":
                            <span class="badge bg-secondary">Chờ xác nhận</span>
                            break;
                        case "DaXacNhan":
                            <span class="badge bg-primary">Đã xác nhận</span>
                            break;
                        case "HoanThanh":
                            <span class="badge bg-success">Hoàn thành</span>
                            break;
                        case "DaHuy":
                            <span class="badge bg-danger">Đã hủy</span>
                            break;
                        default:
                            <span class="badge bg-light text-dark">@item.trangThai</span>
                            break;
                    }
                </td>
                <td>
                    <a asp-action="EditLichHen"
                       asp-route-id="@item.lichHenId"
                       asp-route-ngayBatDau="@ViewBag.NgayBatDau"
                       asp-route-ngayKetThuc="@ViewBag.NgayKetThuc"
                       class="btn btn-sm btn-warning">
                        Cập nhật
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
}
